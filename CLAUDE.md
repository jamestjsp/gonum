# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Build & Test Commands

```bash
# Build
go build ./...

# Test all
go test ./...

# Test single package
go test ./mat

# Test single test
go test ./mat -run TestDense

# Test with build tags
go test -tags bounds ./...   # bounds checks
go test -tags noasm ./...    # no assembly
go test -tags safe ./...     # no assembly or unsafe

# Lint/Format
go tool golang.org/x/tools/cmd/goimports -w .
gofmt -s -w .

# Check imports (blocks math/rand, github.com/gonum/*)
go tool gonum.org/v1/tools/cmd/check-imports -b "math/rand,github.com/gonum/.*"

# Check copyright headers
go tool gonum.org/v1/tools/cmd/check-copyright -notice "(Copyright ©20[0-9]{2} The Gonum Authors\. All rights reserved\.|[Cc]ode generated by .*; DO NOT EDIT\.)"

# Generate (requires ragel for some packages)
go generate ./...
```

## Architecture

Gonum is a numerical computing library. Core packages:

- **mat** - Dense/sparse matrices, linear algebra (uses blas/lapack)
- **blas** - BLAS interface + pure Go implementation (`blas/gonum`)
- **lapack** - LAPACK interface + pure Go implementation (`lapack/gonum`)
- **stat** - Statistics, distributions, sampling
- **graph** - Graph data structures and algorithms
- **optimize** - Function optimization
- **integrate** - Numerical integration
- **floats/cmplxs** - Slice operations for float64/complex128

### Key Patterns

**BLAS/LAPACK layering**: `mat` calls `blas64`/`lapack64` wrappers which call implementation (default: `blas/gonum`, `lapack/gonum`)

**Testing**: Test files in same package. LAPACK uses shared test infrastructure in `lapack/testlapack/`.

**Build tags**: `safe` (no asm/unsafe), `noasm` (no asm), `bounds` (bounds checks)

## Code Style

- Pure Go preferred; assembly opt-out via build tags
- Reference algorithm sources in comments
- No `math/rand` (use `math/rand/v2` or `golang.org/x/exp/rand`)
- No `github.com/gonum/*` imports (use `gonum.org/v1/*`)
- Copyright header required: `// Copyright ©20XX The Gonum Authors. All rights reserved.`

## LAPACK Development

See SPEC.md for detailed specifications on adding new LAPACK routines. Key points:
- Implementation in `lapack/gonum/dXXXXX.go`
- Tests in `lapack/testlapack/dXXXXX.go`
- Panic on invalid inputs, return bool for numerical failures
- Support workspace queries (lwork=-1)
